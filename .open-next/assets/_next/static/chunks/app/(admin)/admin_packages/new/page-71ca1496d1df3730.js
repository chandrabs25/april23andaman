(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9573],{9169:function(e,a,t){Promise.resolve().then(t.bind(t,3878))},9763:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var r=t(2265),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,a)=>{let t=(0,r.forwardRef)((t,i)=>{let{color:l="currentColor",size:o=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:m,...g}=t;return(0,r.createElement)("svg",{ref:i,...s,width:o,height:o,stroke:l,strokeWidth:d?24*Number(c)/Number(o):c,className:["lucide","lucide-".concat(n(e)),u].join(" "),...g},[...a.map(e=>{let[a,t]=e;return(0,r.createElement)(a,t)}),...Array.isArray(m)?m:[m]])});return t.displayName="".concat(e),t}},2660:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5863:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(9763).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9397:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(9763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2489:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7648:function(e,a,t){"use strict";t.d(a,{default:function(){return s.a}});var r=t(2972),s=t.n(r)},9376:function(e,a,t){"use strict";var r=t(5475);t.o(r,"useParams")&&t.d(a,{useParams:function(){return r.useParams}}),t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(a,{useSearchParams:function(){return r.useSearchParams}})},3878:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return u}});var r=t(7437),s=t(2265),n=t(9376),i=t(2660);let l=(0,t(9763).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var o=t(9397),c=t(1079),d=t(7648);function u(){let e=(0,n.useRouter)(),[a,t]=(0,s.useState)(!1),[u,m]=(0,s.useState)(null),[g]=(0,s.useState)("temp-package-"+Date.now()),[p,x]=(0,s.useState)({name:"",description:"",duration:"",base_price:0,max_people:2,itinerary:[],included_services:"",images:[],cancellation_policy:"",is_active:!0,package_categories:[{category_name:"Standard",price:0,hotel_details:"",category_description:"",max_pax_included_in_price:2,images:[],tempId:"temp-category-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))}]}),h=e=>{let{name:a,value:t,type:r}=e.target;if("checkbox"===r){let t=e.target.checked;x(e=>({...e,[a]:t}));return}if("number"===r){x(e=>({...e,[a]:parseFloat(t)||0}));return}x(e=>({...e,[a]:t}))},f=(e,a,t)=>{let r=[...p.package_categories];if("images"===a){console.warn("Direct update to 'images' field in handleCategoryChange is not allowed. Use ImageUploader.");return}"price"===a||"max_pax_included_in_price"===a?r[e][a]="number"==typeof t?t:parseFloat(t)||0:r[e][a]=t,x(e=>({...e,package_categories:r}))},b=e=>{if(1===p.package_categories.length)return;let a=p.package_categories.filter((a,t)=>t!==e);x(e=>({...e,package_categories:a}))},y=(e,a,t)=>{let r=p.itinerary.map((r,s)=>s===e?{...r,[a]:t}:r);x(e=>({...e,itinerary:r}))},j=e=>{p.itinerary.length;let a=p.itinerary.filter((a,t)=>t!==e).map((e,a)=>({...e,day_number:a+1}));x(e=>({...e,itinerary:a}))},v=(e,a)=>{x(t=>{let r=t.package_categories.map((t,r)=>r===e?{...t,images:a}:t);return{...t,package_categories:r}})},N=async a=>{a.preventDefault(),t(!0),m(null);try{let a=await fetch("/api/admin/packages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!a.ok){let e=await a.json();throw Error(e.message||"Error: ".concat(a.status))}let t=await a.json();if(t.success)e.push("/admin_packages");else throw Error(t.message||"Failed to create package")}catch(e){m(e instanceof Error?e.message:"An unknown error occurred"),console.error("Failed to create package:",e)}finally{t(!1)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(d.default,{href:"/admin_packages",className:"text-gray-500 hover:text-gray-700",children:(0,r.jsx)(i.Z,{className:"h-5 w-5"})}),(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Create New Package"})]}),u&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:u}),(0,r.jsxs)("form",{onSubmit:N,className:"space-y-8",children:[(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-medium mb-4",children:"Basic Details"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Name *"}),(0,r.jsx)("input",{type:"text",id:"name",name:"name",required:!0,value:p.name,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"duration",className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration *"}),(0,r.jsx)("input",{type:"text",id:"duration",name:"duration",required:!0,placeholder:"e.g., 3 Days / 2 Nights",value:p.duration,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"base_price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Base Price *"}),(0,r.jsx)("input",{type:"number",id:"base_price",name:"base_price",required:!0,min:"0",step:"0.01",value:p.base_price,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"max_people",className:"block text-sm font-medium text-gray-700 mb-1",children:"Max People"}),(0,r.jsx)("input",{type:"number",id:"max_people",name:"max_people",min:"1",value:p.max_people,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,r.jsx)("textarea",{id:"description",name:"description",rows:3,value:p.description,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Itinerary"}),p.itinerary.map((e,a)=>(0,r.jsxs)("div",{className:"mb-4 p-4 border rounded-md space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("h4",{className:"text-md font-semibold",children:["Day ",a+1]}),(0,r.jsxs)("button",{type:"button",onClick:()=>j(a),disabled:1===p.itinerary.length&&0===a,className:"text-sm font-medium inline-flex items-center ".concat(1===p.itinerary.length&&0===a?"text-gray-400 cursor-not-allowed":"text-red-500 hover:text-red-700"),children:[(0,r.jsx)(l,{className:"h-4 w-4 mr-1"}),"Remove Day"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"itinerary_title_".concat(a),className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),(0,r.jsx)("input",{type:"text",id:"itinerary_title_".concat(a),name:"itinerary_title_".concat(a),value:e.title,onChange:e=>y(a,"title",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Title for Day ".concat(a+1)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"itinerary_description_".concat(a),className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,r.jsx)("textarea",{id:"itinerary_description_".concat(a),name:"itinerary_description_".concat(a),value:e.description,onChange:e=>y(a,"description",e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Description for Day ".concat(a+1)})]})]},a)),(0,r.jsxs)("button",{type:"button",onClick:()=>{x(e=>{let a=e.itinerary.length+1;return{...e,itinerary:[...e.itinerary,{day_number:a,title:"",description:""}]}})},className:"mt-2 px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-flex items-center",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),"Add Day"]})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{htmlFor:"included_services",className:"block text-sm font-medium text-gray-700 mb-1",children:"Included Services"}),(0,r.jsx)("textarea",{id:"included_services",name:"included_services",rows:3,value:p.included_services,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Airport transfers, Sightseeing, Meals, etc."})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{htmlFor:"cancellation_policy",className:"block text-sm font-medium text-gray-700 mb-1",children:"Cancellation Policy"}),(0,r.jsx)("textarea",{id:"cancellation_policy",name:"cancellation_policy",rows:3,value:p.cancellation_policy,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Cancellation terms and conditions..."})]}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)(c.w,{label:"Package Images",onImagesUploaded:e=>{x(a=>({...a,images:e}))},existingImages:p.images,parentId:g,type:"package",maxImages:5,helperText:"Upload images for the package. (Max 5 images)"})}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"is_active",name:"is_active",checked:p.is_active,onChange:e=>x(a=>({...a,is_active:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-900",children:"Active (visible to users)"})]})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-medium",children:"Package Categories"}),(0,r.jsxs)("button",{type:"button",onClick:()=>{x(e=>({...e,package_categories:[...e.package_categories,{category_name:"",price:0,hotel_details:"",category_description:"",max_pax_included_in_price:2,images:[],tempId:"temp-category-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))}]}))},className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),"Add Category"]})]}),p.package_categories.map((e,a)=>(0,r.jsxs)("div",{className:"mb-8 border-b pb-6 last:border-b-0 last:pb-0",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium",children:["Category ",a+1]}),(0,r.jsxs)("button",{type:"button",onClick:()=>b(a),disabled:1===p.package_categories.length,className:"inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md ".concat(1===p.package_categories.length?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"),children:[(0,r.jsx)(l,{className:"h-4 w-4 mr-1"}),"Remove"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category Name *"}),(0,r.jsx)("input",{type:"text",required:!0,value:e.category_name,onChange:e=>f(a,"category_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Standard, Deluxe, Premium"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price *"}),(0,r.jsx)("input",{type:"number",required:!0,min:"0",step:"0.01",value:e.price,onChange:e=>f(a,"price",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max People Included in Price"}),(0,r.jsx)("input",{type:"number",min:"1",value:e.max_pax_included_in_price,onChange:e=>f(a,"max_pax_included_in_price",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hotel Details"}),(0,r.jsx)("textarea",{rows:3,value:e.hotel_details,onChange:e=>f(a,"hotel_details",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Port Blair: Hotel Royal Palace - Deluxe AC Room, Havelock: Symphony Palms - Premium Cottage"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category Description"}),(0,r.jsx)("textarea",{rows:2,value:e.category_description,onChange:e=>f(a,"category_description",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Additional information about this category"})]}),(0,r.jsx)("div",{className:"md:col-span-2 mt-4",children:(0,r.jsx)(c.w,{label:"Category Images",onImagesUploaded:e=>v(a,e),existingImages:e.images,parentId:e.tempId,type:"package_category",maxImages:3,helperText:"Upload images for ".concat(e.category_name||"Category ".concat(a+1),". (Max 3 images)")})})]})]},a))]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)(d.default,{href:"/admin_packages",className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:a,className:"px-4 py-2 border border-transparent rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(a?"opacity-75 cursor-not-allowed":""),children:a?"Creating...":"Create Package"})]})]})]})}},1079:function(e,a,t){"use strict";t.d(a,{w:function(){return c}});var r=t(7437),s=t(2265);let n=(0,t(9763).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var i=t(2489),l=t(5863),o=t(9397);function c(e){let{label:a,onImagesUploaded:t,existingImages:c=[],parentId:d,type:u,maxImages:m=10,helperText:g}=e,[p,x]=(0,s.useState)(c),[h,f]=(0,s.useState)(!1),[b,y]=(0,s.useState)(null),[j,v]=(0,s.useState)(!1),N=(0,s.useRef)(null),_=async e=>{let a=e.target.files;if(!a||0===a.length)return;if(p.length+a.length>m){y("You can only upload a maximum of ".concat(m," images"));return}f(!0),y(null);let r=new FormData;r.append("parentId",d.toString()),r.append("type",u),Array.from(a).forEach(e=>{r.append("images",e)});try{var s;let e=await fetch("/api/upload/images",{method:"POST",body:r});if(!e.ok){let a=await e.json();throw Error(a.message||a.error||"Failed to upload images")}let a=await e.json();(null===(s=a.message)||void 0===s?void 0:s.includes("Cloudflare environment"))&&v(!0);let n=a.imageUrls,i=[...p,...n];x(i),t(i)}catch(e){console.error("Upload error:",e),y(e instanceof Error?e.message:"Failed to upload images")}finally{f(!1),N.current&&(N.current.value="")}},k=e=>{let a=p.filter((a,t)=>t!==e);x(a),t(a)};return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:a}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-3",children:[p.map((e,a)=>(0,r.jsxs)("div",{className:"relative group aspect-square border border-gray-200 rounded-md overflow-hidden shadow-sm",children:[j?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100 text-gray-500",children:(0,r.jsxs)("div",{className:"text-center p-2",children:[(0,r.jsx)(n,{size:24,className:"mx-auto mb-1"}),(0,r.jsxs)("span",{className:"text-xs",children:["Image ",a+1]})]})}):(0,r.jsx)("img",{src:e,alt:"Uploaded image ".concat(a+1),className:"w-full h-full object-cover"}),(0,r.jsx)("button",{type:"button",onClick:()=>k(a),className:"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:(0,r.jsx)(i.Z,{size:14})})]},a)),p.length<m&&(0,r.jsx)("button",{type:"button",onClick:()=>{N.current&&N.current.click()},disabled:h,className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-md aspect-square hover:border-gray-400 transition-colors",children:h?(0,r.jsx)(l.Z,{className:"h-6 w-6 animate-spin text-gray-500"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{size:24,className:"text-gray-400"}),(0,r.jsx)("span",{className:"text-xs text-gray-500 mt-2",children:"Add Image"})]})})]}),(0,r.jsx)("input",{type:"file",ref:N,onChange:_,className:"hidden",accept:"image/*",multiple:p.length<m}),b&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:b}),j&&(0,r.jsxs)("p",{className:"text-amber-500 text-sm",children:[(0,r.jsx)("strong",{children:"Note:"})," In development mode, images are not actually stored. They will appear as placeholders."]}),g&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:g}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:[p.length," of ",m," images uploaded"]})]})}}},function(e){e.O(0,[2972,2971,2117,1744],function(){return e(e.s=9169)}),_N_E=e.O()}]);