(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9791],{9644:function(e,t,s){Promise.resolve().then(s.bind(s,8564))},3639:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2660:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},4794:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},8564:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y},dynamic:function(){return h}});var r=s(7437),a=s(2265),o=s(9376),n=s(4603),i=s(9889),l=s(3340),d=s(5863),m=s(3639),c=s(4794),u=s(2660),x=s(7648);let h="force-dynamic",p=e=>{let{text:t="Loading..."}=e;return(0,r.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,r.jsx)(d.Z,{className:"h-6 w-6 animate-spin text-blue-600 mr-2"}),(0,r.jsx)("span",{children:t})]})},f=()=>(0,r.jsxs)("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md shadow-md mb-8",role:"alert",children:[(0,r.jsxs)("p",{className:"font-bold flex items-center",children:[(0,r.jsx)(m.Z,{size:18,className:"mr-2"}),"Verification Pending"]}),(0,r.jsx)("p",{children:"Your account must be verified before you can edit rooms. Please check your profile status or contact support."}),(0,r.jsx)(x.default,{href:"/dashboard",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Return to Dashboard"})]}),b=()=>(0,r.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md mb-8",role:"alert",children:[(0,r.jsxs)("p",{className:"font-bold flex items-center",children:[(0,r.jsx)(c.Z,{size:18,className:"mr-2"}),"Incorrect Vendor Type"]}),(0,r.jsx)("p",{children:"This page is for editing Hotel Rooms. Non-hotel vendors should use the Service Management section."}),(0,r.jsx)(x.default,{href:"/services",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Go to Service Management"}),(0,r.jsx)("br",{}),(0,r.jsx)(x.default,{href:"/dashboard",className:"text-sm text-gray-600 hover:underline mt-1 inline-block",children:"Return to Dashboard"})]});function g(){let e=(0,o.useRouter)(),t=(0,o.useParams)(),s=t.serviceId,m=t.roomId,{user:c,isLoading:h,isAuthenticated:g}=(0,n.a)(),[y,v]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),_=(null==c?void 0:c.id)?"/api/vendors/profile?userId=".concat(c.id):null,{data:k,error:w,status:R}=(0,i.i)(_),E=(null==k?void 0:k.verified)===1,C=(null==k?void 0:k.type)==="hotel",S="success"===R&&k&&E&&C&&!!s,q=S?"/api/vendor/hotels/".concat(s):null,{data:A,error:Z,status:F}=(0,i.i)(q),P=(null==A?void 0:A.name)||"Hotel ".concat(s),L="success"===F&&!!A&&!!m,M=L?"/api/vendor/hotels/".concat(s,"/rooms/").concat(m):null,{data:I,error:T,status:z}=(0,i.i)(M);if((0,a.useEffect)(()=>{if("success"===z&&I){var e;v({room_type_name:I.room_type_name,base_price:I.base_price.toString(),max_guests:I.max_guests.toString(),quantity_available:(null===(e=I.quantity_available)||void 0===e?void 0:e.toString())||"",amenities:(e=>{if(!e)return"";try{let t=JSON.parse(e);return Array.isArray(t)?t.join(", "):""}catch(e){return console.error("Failed to parse JSON array:",e),""}})(I.amenities),images:I.images||""})}},[z,I]),(0,a.useEffect)(()=>{h||g&&(null==c?void 0:c.role_id)===3||e.replace("/auth/signin?reason=unauthorized_vendor")},[h,g,c,e]),h||"loading"===R||S&&"loading"===F||L&&"loading"===z)return(0,r.jsx)(p,{text:"Loading Edit Room Form..."});if("error"===R)return(0,r.jsxs)("div",{className:"text-red-600",children:["Error loading vendor profile:"," ",(null==w?void 0:w.message)||"Unknown error"]});if("success"===R&&!k)return(0,r.jsx)("div",{className:"text-orange-600",children:"Vendor profile not found. Cannot edit room."});if(!E)return(0,r.jsx)(f,{});if(!C)return(0,r.jsx)(b,{});if("error"===F||"success"===F&&!A)return(0,r.jsxs)("div",{className:"text-red-600",children:["Error loading hotel details: ",(null==Z?void 0:Z.message)||"Hotel not found or permission denied.",(0,r.jsx)("br",{}),(0,r.jsx)(x.default,{href:"/hotels",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Return to Hotel List"})]});if("error"===z)return(0,r.jsxs)("div",{className:"text-red-600",children:["Error loading room details: ",(null==T?void 0:T.message)||"Unknown error",(0,r.jsx)("br",{}),(0,r.jsxs)(x.default,{href:"/hotels/".concat(s,"/rooms"),className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:["Return to Room List for ",P]})]});if("success"===z&&!I)return(0,r.jsxs)("div",{className:"text-orange-600",children:["Room not found or you do not have permission to edit it.",(0,r.jsx)("br",{}),(0,r.jsxs)(x.default,{href:"/hotels/".concat(s,"/rooms"),className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:["Return to Room List for ",P]})]});if(!y)return(0,r.jsx)(p,{text:"Preparing form..."});let B=e=>{let{name:t,value:s}=e.target;v(e=>e?{...e,[t]:s}:null)},H=async t=>{if(t.preventDefault(),!y)return;if(N(!0),!y.room_type_name||!y.base_price||!y.max_guests){(0,l.Am)({variant:"destructive",title:"Error",description:"Please fill in Room Type Name, Base Price, and Max Guests."}),N(!1);return}let r={room_type_name:y.room_type_name,base_price:parseFloat(y.base_price),max_guests:parseInt(y.max_guests,10),quantity_available:y.quantity_available?parseInt(y.quantity_available,10):void 0,amenities:y.amenities.split(",").map(e=>e.trim()).filter(Boolean),images:y.images};try{let t=await fetch("/api/vendor/hotels/".concat(s,"/rooms/").concat(m),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=await t.json();if(!t.ok||!a.success)throw Error(a.message||"Failed to update room type");(0,l.Am)({title:"Success",description:"Room type updated successfully."}),e.push("/hotels/".concat(s,"/rooms"))}catch(e){console.error("Error updating room type:",e),(0,l.Am)({variant:"destructive",title:"Error",description:e instanceof Error?e.message:"Could not update room type."})}finally{N(!1)}};return(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md max-w-2xl mx-auto",children:[(0,r.jsxs)(x.default,{href:"/hotels/".concat(s,"/rooms"),className:"text-sm text-blue-600 hover:underline mb-4 inline-flex items-center",children:[(0,r.jsx)(u.Z,{size:14,className:"mr-1"})," Back to Rooms for ",P]}),(0,r.jsxs)("h2",{className:"text-xl font-bold mb-6",children:["Edit Room Type: ",(null==I?void 0:I.room_type_name)||""]}),(0,r.jsxs)("form",{onSubmit:H,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"room_type_name",className:"block text-sm font-medium text-gray-700",children:["Room Type Name ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",id:"room_type_name",name:"room_type_name",value:y.room_type_name,onChange:B,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"base_price",className:"block text-sm font-medium text-gray-700",children:["Base Price/Night (INR) ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"number",id:"base_price",name:"base_price",value:y.base_price,onChange:B,required:!0,min:"0",step:"0.01",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"max_guests",className:"block text-sm font-medium text-gray-700",children:["Max Guests ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"number",id:"max_guests",name:"max_guests",value:y.max_guests,onChange:B,required:!0,min:"1",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"quantity_available",className:"block text-sm font-medium text-gray-700",children:"Quantity Available"}),(0,r.jsx)("input",{type:"number",id:"quantity_available",name:"quantity_available",value:y.quantity_available,onChange:B,min:"0",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Leave blank if not applicable."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"amenities",className:"block text-sm font-medium text-gray-700",children:"Amenities (comma-separated)"}),(0,r.jsx)("input",{type:"text",id:"amenities",name:"amenities",value:y.amenities,onChange:B,placeholder:"Wi-Fi, Balcony, AC",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"images",className:"block text-sm font-medium text-gray-700",children:"Image URLs (comma-separated)"}),(0,r.jsx)("input",{type:"text",id:"images",name:"images",value:y.images,onChange:B,placeholder:"http://..., http://...",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{className:"flex justify-end pt-4",children:[(0,r.jsx)(x.default,{href:"/hotels/".concat(s,"/rooms"),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm hover:bg-gray-300 mr-2",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:j,className:"inline-flex items-center bg-green-600 text-white px-4 py-2 rounded-md text-sm hover:bg-green-700 disabled:opacity-50 disabled:cursor-wait",children:j?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{size:16,className:"animate-spin mr-2"})," Saving Changes..."]}):"Save Changes"})]})]})]})}function y(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)(p,{text:"Loading Edit Room Page..."}),children:(0,r.jsx)(g,{})})}}},function(e){e.O(0,[1451,8146,2971,2117,1744],function(){return e(e.s=9644)}),_N_E=e.O()}]);