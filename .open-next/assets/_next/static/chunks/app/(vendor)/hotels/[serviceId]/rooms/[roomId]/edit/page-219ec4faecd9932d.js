(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9791],{9644:function(e,t,s){Promise.resolve().then(s.bind(s,8564))},2660:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},4794:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},8564:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y},dynamic:function(){return h}});var a=s(7437),r=s(2265),o=s(9376),n=s(4603),i=s(9889),l=s(3340),d=s(5863),m=s(3639),c=s(4794),u=s(2660),x=s(7648);let h="force-dynamic",p=e=>{let{text:t="Loading..."}=e;return(0,a.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,a.jsx)(d.Z,{className:"h-6 w-6 animate-spin text-blue-600 mr-2"}),(0,a.jsx)("span",{children:t})]})},f=()=>(0,a.jsxs)("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md shadow-md mb-8",role:"alert",children:[(0,a.jsxs)("p",{className:"font-bold flex items-center",children:[(0,a.jsx)(m.Z,{size:18,className:"mr-2"}),"Verification Pending"]}),(0,a.jsx)("p",{children:"Your account must be verified before you can edit rooms. Please check your profile status or contact support."}),(0,a.jsx)(x.default,{href:"/dashboard",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Return to Dashboard"})]}),b=()=>(0,a.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md mb-8",role:"alert",children:[(0,a.jsxs)("p",{className:"font-bold flex items-center",children:[(0,a.jsx)(c.Z,{size:18,className:"mr-2"}),"Incorrect Vendor Type"]}),(0,a.jsx)("p",{children:"This page is for editing Hotel Rooms. Non-hotel vendors should use the Service Management section."}),(0,a.jsx)(x.default,{href:"/services",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Go to Service Management"}),(0,a.jsx)("br",{}),(0,a.jsx)(x.default,{href:"/dashboard",className:"text-sm text-gray-600 hover:underline mt-1 inline-block",children:"Return to Dashboard"})]});function g(){var e,t;let s=(0,o.useRouter)(),m=(0,o.useParams)(),c=m.serviceId,h=m.roomId,{user:g,isLoading:y,isAuthenticated:v}=(0,n.a)(),[j,_]=(0,r.useState)(null),[N,k]=(0,r.useState)(!1),w=(null==g?void 0:g.id)?"/api/vendors/profile?userId=".concat(g.id):null,{data:R,error:E,status:C}=(0,i.i)(w),S=null==R?void 0:R.data,q=(null==S?void 0:S.verified)===1,F=(null==S?void 0:S.type)==="hotel",A="success"===C&&q&&F&&!!c,P=A?"/api/vendor/hotels/".concat(c):null,{data:Z,error:I,status:L}=(0,i.i)(P),M=(null==Z?void 0:null===(e=Z.data)||void 0===e?void 0:e.name)||"Hotel ".concat(c),T="success"===L&&!!(null==Z?void 0:Z.data)&&!!h,z=T?"/api/vendor/hotels/".concat(c,"/rooms/").concat(h):null,{data:B,error:H,status:O}=(0,i.i)(z);if((0,r.useEffect)(()=>{if((null==B?void 0:B.success)&&B.data){var e;let t=B.data;_({room_type_name:t.room_type_name,base_price:t.base_price.toString(),max_guests:t.max_guests.toString(),quantity_available:(null===(e=t.quantity_available)||void 0===e?void 0:e.toString())||"",amenities:(e=>{if(!e)return"";try{let t=JSON.parse(e);return Array.isArray(t)?t.join(", "):""}catch(e){return console.error("Failed to parse JSON array:",e),""}})(t.amenities),images:t.images||""})}},[B]),(0,r.useEffect)(()=>{y||v&&(null==g?void 0:g.role_id)===3||s.replace("/auth/signin?reason=unauthorized_vendor")},[y,v,g,s]),y||"loading"===C||A&&"loading"===L||T&&"loading"===O)return(0,a.jsx)(p,{text:"Loading Edit Room Form..."});if("error"===C)return(0,a.jsxs)("div",{className:"text-red-600",children:["Error loading vendor profile:"," ",(null==E?void 0:E.message)||(null==R?void 0:R.message)]});if("success"===C&&!S)return(0,a.jsx)("div",{className:"text-orange-600",children:"Vendor profile not found. Cannot edit room."});if(!q)return(0,a.jsx)(f,{});if(!F)return(0,a.jsx)(b,{});if("error"===L||"success"===L&&!(null==Z?void 0:Z.data))return(0,a.jsxs)("div",{className:"text-red-600",children:["Error loading hotel details: ",(null==I?void 0:I.message)||(null==Z?void 0:Z.message)||"Hotel not found or permission denied.",(0,a.jsx)("br",{}),(0,a.jsx)(x.default,{href:"/hotels",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Return to Hotel List"})]});if("error"===O)return(0,a.jsxs)("div",{className:"text-red-600",children:["Error loading room type details: ",(null==H?void 0:H.message)||(null==B?void 0:B.message)]});if("success"===O&&!(null==B?void 0:B.data))return(0,a.jsxs)("div",{className:"text-orange-600",children:["Room type with ID ",h," not found for this hotel or you do not have permission to edit it.",(0,a.jsx)("br",{}),(0,a.jsx)(x.default,{href:"/hotels/".concat(c,"/rooms"),className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Return to Room List"})]});if(!j)return(0,a.jsx)(p,{text:"Preparing form..."});let D=e=>{let{name:t,value:s}=e.target;_(e=>e?{...e,[t]:s}:null)},V=async e=>{if(e.preventDefault(),!j)return;if(k(!0),!j.room_type_name||!j.base_price||!j.max_guests){(0,l.Am)({variant:"destructive",title:"Error",description:"Please fill in Room Type Name, Base Price, and Max Guests."}),k(!1);return}let t={room_type_name:j.room_type_name,base_price:parseFloat(j.base_price),max_guests:parseInt(j.max_guests,10),quantity_available:j.quantity_available?parseInt(j.quantity_available,10):void 0,amenities:j.amenities.split(",").map(e=>e.trim()).filter(Boolean),images:j.images};try{let e=await fetch("/api/vendor/hotels/".concat(c,"/rooms/").concat(h),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await e.json();if(!e.ok||!a.success)throw Error(a.message||"Failed to update room type");(0,l.Am)({title:"Success",description:"Room type updated successfully."}),s.push("/hotels/".concat(c,"/rooms"))}catch(e){console.error("Error updating room type:",e),(0,l.Am)({variant:"destructive",title:"Error",description:e instanceof Error?e.message:"Could not update room type."})}finally{k(!1)}};return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md max-w-2xl mx-auto",children:[(0,a.jsxs)(x.default,{href:"/hotels/".concat(c,"/rooms"),className:"text-sm text-blue-600 hover:underline mb-4 inline-flex items-center",children:[(0,a.jsx)(u.Z,{size:14,className:"mr-1"})," Back to Rooms for ",M]}),(0,a.jsxs)("h2",{className:"text-xl font-bold mb-6",children:["Edit Room Type: ",(null==B?void 0:null===(t=B.data)||void 0===t?void 0:t.room_type_name)||""]}),(0,a.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"room_type_name",className:"block text-sm font-medium text-gray-700",children:["Room Type Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",id:"room_type_name",name:"room_type_name",value:j.room_type_name,onChange:D,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"base_price",className:"block text-sm font-medium text-gray-700",children:["Base Price/Night (INR) ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"number",id:"base_price",name:"base_price",value:j.base_price,onChange:D,required:!0,min:"0",step:"0.01",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"max_guests",className:"block text-sm font-medium text-gray-700",children:["Max Guests ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"number",id:"max_guests",name:"max_guests",value:j.max_guests,onChange:D,required:!0,min:"1",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"quantity_available",className:"block text-sm font-medium text-gray-700",children:"Quantity Available"}),(0,a.jsx)("input",{type:"number",id:"quantity_available",name:"quantity_available",value:j.quantity_available,onChange:D,min:"0",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Leave blank if not applicable."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"amenities",className:"block text-sm font-medium text-gray-700",children:"Amenities (comma-separated)"}),(0,a.jsx)("input",{type:"text",id:"amenities",name:"amenities",value:j.amenities,onChange:D,placeholder:"Wi-Fi, Balcony, AC",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"images",className:"block text-sm font-medium text-gray-700",children:"Image URLs (comma-separated)"}),(0,a.jsx)("input",{type:"text",id:"images",name:"images",value:j.images,onChange:D,placeholder:"http://..., http://...",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsxs)("div",{className:"flex justify-end pt-4",children:[(0,a.jsx)(x.default,{href:"/hotels/".concat(c,"/rooms"),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm hover:bg-gray-300 mr-2",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:N,className:"inline-flex items-center bg-green-600 text-white px-4 py-2 rounded-md text-sm hover:bg-green-700 disabled:opacity-50 disabled:cursor-wait",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{size:16,className:"animate-spin mr-2"})," Saving Changes..."]}):"Save Changes"})]})]})]})}function y(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(p,{text:"Loading Edit Room Page..."}),children:(0,a.jsx)(g,{})})}}},function(e){e.O(0,[1451,1959,2971,2117,1744],function(){return e(e.s=9644)}),_N_E=e.O()}]);