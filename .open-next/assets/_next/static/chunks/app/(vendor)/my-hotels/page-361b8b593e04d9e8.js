(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[855],{3050:function(e,t,s){Promise.resolve().then(s.bind(s,5574))},7920:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("BedDouble",[["path",{d:"M2 20v-8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v8",key:"1k78r4"}],["path",{d:"M4 10V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4",key:"fb3tl2"}],["path",{d:"M12 4v6",key:"1dcgq2"}],["path",{d:"M2 18h20",key:"ajqnye"}]])},4794:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},8866:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]])},6034:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]])},5574:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w},dynamic:function(){return y}});var r=s(7437),a=s(2265),i=s(7648),n=s(9376),l=s(4603),c=s(9889),d=s(5863),o=s(4794),x=s(285),u=s(6034),h=s(8866),m=s(7920),p=s(4630),f=s(8930),g=s(3340);let y="force-dynamic",v=e=>{let{text:t="Loading..."}=e;return(0,r.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,r.jsx)(d.Z,{className:"h-6 w-6 animate-spin text-blue-600 mr-2"}),(0,r.jsx)("span",{children:t})]})},j=()=>(0,r.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md mb-8",role:"alert",children:[(0,r.jsxs)("p",{className:"font-bold flex items-center",children:[(0,r.jsx)(o.Z,{size:18,className:"mr-2"}),"Incorrect Vendor Type"]}),(0,r.jsx)("p",{children:"This page is for managing Hotels. Non-hotel vendors should use the Service Management section."}),(0,r.jsx)(i.default,{href:"/my-services",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Go to Service Management"}),(0,r.jsx)("br",{}),(0,r.jsx)(i.default,{href:"/dashboard",className:"text-sm text-gray-600 hover:underline mt-1 inline-block",children:"Return to Dashboard"})]});function N(){let e=(0,n.useRouter)(),{user:t,isLoading:s,isAuthenticated:o}=(0,l.a)(),[y,N]=(0,a.useState)([]),[w,b]=(0,a.useState)(null),[k,_]=(0,a.useState)(null),E=(null==t?void 0:t.id)?"/api/vendors/profile?userId=".concat(t.id):null,{data:Z,error:A,status:M}=(0,c.i)(E),S=(null==Z?void 0:Z.verified)===1,z=(null==Z?void 0:Z.type)==="hotel",H="success"===M&&Z&&S&&z,{data:C,error:T,status:L}=(0,c.i)(H?"/api/vendor/my-hotels":null),{data:D,status:I}=(0,c.i)("/api/islands"),R=a.useMemo(()=>{let e=new Map;return null==D||D.forEach(t=>e.set(t.id,t.name)),e},[D]);if((0,a.useEffect)(()=>{"success"===L&&C&&N(C)},[L,C]),(0,a.useEffect)(()=>{s||o&&(null==t?void 0:t.role_id)===3||e.replace("/auth/signin?reason=unauthorized_vendor")},[s,o,t,e]),s||"loading"===M||H&&"loading"===L||"loading"===I)return(0,r.jsx)(v,{text:"Loading Hotels..."});if("error"===M)return(0,r.jsxs)("div",{className:"text-red-600",children:["Error loading vendor profile:"," ",(null==A?void 0:A.message)||"Unknown error"]});if("success"===M&&!Z)return(0,r.jsx)("div",{className:"text-orange-600",children:"Vendor profile not found. Cannot load hotels."});if(!z)return(0,r.jsx)(j,{});if("error"===L)return(0,r.jsxs)("div",{className:"text-red-600",children:["Error loading hotels: ",(null==T?void 0:T.message)||"Unknown error"]});let P=async(e,t)=>{b(e);try{let s=await fetch("/api/vendor/services/".concat(e,"/status"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!t})}),r=await s.json();if(!s.ok||!r.success)throw Error(r.message||"Failed to update status");(0,g.Am)({title:"Success",description:"Hotel ".concat(t?"deactivated":"activated",".")}),N(s=>s.map(s=>s.service_id===e?{...s,is_active:t?0:1}:s))}catch(e){console.error("Error toggling hotel status:",e),(0,g.Am)({variant:"destructive",title:"Error",description:e instanceof Error?e.message:"Could not update hotel status."})}finally{b(null)}},V=async e=>{if(confirm("Are you sure you want to delete this hotel and all its associated room types? This action cannot be undone.")){_(e);try{let t=await fetch("/api/vendor/my-hotels/".concat(e),{method:"DELETE"}),s=await t.json();if(!t.ok||!s.success)throw Error(s.message||"Failed to delete hotel");(0,g.Am)({title:"Success",description:"Hotel deleted successfully."}),N(t=>t.filter(t=>t.service_id!==e))}catch(e){console.error("Error deleting hotel:",e),(0,g.Am)({variant:"destructive",title:"Error",description:e instanceof Error?e.message:"Could not delete hotel."})}finally{_(null)}}};return(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"Manage Hotels"}),(0,r.jsxs)(i.default,{href:"/my-hotels/add",className:"inline-flex items-center bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700",children:[(0,r.jsx)(x.Z,{size:16,className:"mr-2"})," Add New Hotel"]})]}),0===y.length&&"success"===L?(0,r.jsx)("p",{className:"text-gray-500 text-center py-4",children:"You haven't added any hotels yet."}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hotel Name"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rating"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Island"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Address"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.star_rating," Star"]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:R.get(e.island_id)||"ID: ".concat(e.island_id)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 truncate max-w-xs",children:e.street_address}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,r.jsxs)("button",{onClick:()=>P(e.service_id,1===e.is_active),disabled:w===e.service_id,className:"flex items-center px-2 py-1 rounded-full text-xs ".concat(1===e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"," disabled:opacity-50 disabled:cursor-wait"),children:[w===e.service_id?(0,r.jsx)(d.Z,{size:14,className:"animate-spin mr-1"}):1===e.is_active?(0,r.jsx)(u.Z,{size:14,className:"mr-1"}):(0,r.jsx)(h.Z,{size:14,className:"mr-1"}),1===e.is_active?"Active":"Inactive"]})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[(0,r.jsx)(i.default,{href:"/my-hotels/".concat(e.service_id,"/rooms"),className:"text-green-600 hover:text-green-900 inline-flex items-center",title:"Manage Rooms",children:(0,r.jsx)(m.Z,{size:16})}),(0,r.jsx)(i.default,{href:"/my-hotels/".concat(e.service_id,"/edit"),className:"text-indigo-600 hover:text-indigo-900 inline-flex items-center",title:"Edit Hotel",children:(0,r.jsx)(p.Z,{size:16})}),(0,r.jsx)("button",{onClick:()=>V(e.service_id),disabled:k===e.service_id,className:"text-red-600 hover:text-red-900 inline-flex items-center disabled:opacity-50 disabled:cursor-wait",title:"Delete Hotel",children:k===e.service_id?(0,r.jsx)(d.Z,{size:16,className:"animate-spin"}):(0,r.jsx)(f.Z,{size:16})})]})]},e.service_id))})]})})]})}function w(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)(v,{text:"Loading Hotels Page..."}),children:(0,r.jsx)(N,{})})}}},function(e){e.O(0,[1451,4020,2971,2117,1744],function(){return e(e.s=3050)}),_N_E=e.O()}]);