(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9643],{8948:function(e,s,t){Promise.resolve().then(t.bind(t,287))},3639:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},7920:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("BedDouble",[["path",{d:"M2 20v-8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v8",key:"1k78r4"}],["path",{d:"M4 10V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4",key:"fb3tl2"}],["path",{d:"M12 4v6",key:"1dcgq2"}],["path",{d:"M2 18h20",key:"ajqnye"}]])},287:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return j},dynamic:function(){return h}});var a=t(7437),r=t(2265),i=t(9376),n=t(4603),l=t(9889),o=t(3340),d=t(5863),m=t(3639),c=t(7920),u=t(7648),x=t(3500);let h="force-dynamic",p=[{label:"Wi-Fi",value:"wifi"},{label:"Air Conditioning",value:"ac"},{label:"Heating",value:"heating"},{label:"Television",value:"tv"},{label:"Mini Bar",value:"minibar"},{label:"Coffee/Tea Maker",value:"coffee_maker"},{label:"Hair Dryer",value:"hair_dryer"},{label:"Iron & Board",value:"iron"},{label:"Balcony/Patio",value:"balcony"},{label:"Ensuite Bathroom",value:"ensuite"},{label:"Work Desk",value:"desk"},{label:"Safe",value:"safe"}],f=e=>{let{text:s="Loading..."}=e;return(0,a.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,a.jsx)(d.Z,{className:"h-6 w-6 animate-spin text-blue-600 mr-2"}),(0,a.jsx)("span",{children:s})]})},g=()=>(0,a.jsxs)("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md shadow-md max-w-2xl mx-auto my-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("h3",{className:"font-semibold",children:"Verification Pending"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm",children:"Your vendor profile is awaiting verification. You cannot manage services until verified."})]}),b=()=>(0,a.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md max-w-2xl mx-auto my-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("h3",{className:"font-semibold",children:"Incorrect Vendor Type"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm",children:"This section is for Hotel vendors only."})]}),y=e=>{let{label:s,name:t,value:i,onChange:n,placeholder:l,helperText:o}=e,[d,m]=(0,r.useState)(""),c=e=>{n(t,i.filter(s=>s!==e))};return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 mb-1",children:s}),(0,a.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-1 p-2 border border-gray-300 rounded-md shadow-sm bg-white",children:[i.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",children:[e,(0,a.jsxs)("button",{type:"button",onClick:()=>c(e),className:"ml-1.5 flex-shrink-0 text-indigo-500 hover:text-indigo-700 focus:outline-none",children:[(0,a.jsxs)("span",{className:"sr-only",children:["Remove ",e]}),"\xd7"]})]},e)),(0,a.jsx)("input",{type:"text",id:t,value:d,onChange:e=>m(e.target.value),onKeyDown:e=>{if(","===e.key||"Enter"===e.key){e.preventDefault();let s=d.trim();s&&!i.includes(s)&&n(t,[...i,s]),m("")}},placeholder:l||"Add item and press Enter or comma",className:"flex-grow px-1 py-0.5 border-none focus:ring-0 sm:text-sm outline-none"})]}),o&&(0,a.jsx)("p",{className:"mt-1.5 text-xs text-gray-500",children:o})]})};function v(){let e=(0,i.useRouter)(),s=(0,i.useParams)(),t=s.serviceId,m=s.roomId,{user:h,isLoading:v,isAuthenticated:j}=(0,n.a)(),[N,_]=(0,r.useState)(null),[w,k]=(0,r.useState)(!1),E=(null==h?void 0:h.id)?"/api/vendors/profile?userId=".concat(h.id):null,{data:R,error:S,status:C}=(0,l.i)(E),q=(null==R?void 0:R.verified)===1,A=(null==R?void 0:R.type)==="hotel",F="success"===C&&R&&q&&A&&!!t,I=F?"/api/vendor/hotels/".concat(t):null,{data:T,error:P,status:D}=(0,l.i)(I),L=(null==T?void 0:T.name)||"Hotel ".concat(t),M="success"===D&&!!T&&!!m,Z=M?"/api/vendor/hotels/".concat(t,"/rooms/").concat(m):null,{data:B,error:H,status:O}=(0,l.i)(Z),J=(e,s)=>{if(!e||"string"!=typeof e||!e.trim())return[];try{let t=JSON.parse(e);if(Array.isArray(t)&&t.every(e=>"string"==typeof e))return t;if(console.warn("Parsed ".concat(s," data is not an array of strings:"),t),"string"==typeof t&&t.trim())return[t.trim()];return[]}catch(t){if(console.error("Failed to parse ".concat(s," JSON:"),e,t),"string"==typeof e&&e.includes(","))return e.split(",").map(e=>e.trim()).filter(Boolean);if("string"==typeof e&&e.trim())return[e.trim()];return[]}};(0,r.useEffect)(()=>{if("success"===O&&B){var e;let s=J(B.amenities,"amenities"),t=J(B.images,"images");_({room_type_name:B.room_type_name,base_price:B.base_price.toString(),max_guests:B.max_guests.toString(),quantity_available:(null===(e=B.quantity_available)||void 0===e?void 0:e.toString())||"",amenities:s,images:t})}},[O,B]),(0,r.useEffect)(()=>{v||j&&(null==h?void 0:h.role_id)===3||e.replace("/auth/signin?reason=unauthorized_vendor")},[v,j,h,e]);let U=v||"loading"===C||F&&"loading"===D||M&&"loading"===O;if(U)return(0,a.jsx)(f,{text:"Loading Edit Room Form..."});if("error"===C||"success"===C&&!R)return(0,a.jsx)("div",{className:"text-red-600",children:"Error loading vendor profile or profile not found."});if(!q)return(0,a.jsx)(g,{});if(!A)return(0,a.jsx)(b,{});if("error"===D||"success"===D&&!T)return(0,a.jsxs)("div",{className:"text-red-600",children:["Error loading hotel details: ",(null==P?void 0:P.message)||"Hotel not found or permission denied.",(0,a.jsx)("br",{}),(0,a.jsx)(u.default,{href:"/hotels",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Return to Hotel List"})]});if("error"===O)return(0,a.jsxs)("div",{className:"text-red-600",children:["Error loading room details: ",(null==H?void 0:H.message)||"Unknown error",(0,a.jsx)("br",{}),(0,a.jsxs)(u.default,{href:"/hotels/".concat(t,"/rooms"),className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:["Return to Room List for ",L]})]});if("success"===O&&!B)return(0,a.jsxs)("div",{className:"text-orange-600",children:["Room not found or you do not have permission to edit it.",(0,a.jsx)("br",{}),(0,a.jsxs)(u.default,{href:"/hotels/".concat(t,"/rooms"),className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:["Return to Room List for ",L]})]});if(!N)return(0,a.jsx)(f,{text:"Preparing form..."});let V=e=>{let{name:s,value:t}=e.target;_(e=>e?{...e,[s]:t}:null)},z=(e,s)=>{_(t=>t?{...t,[e]:s}:null)},G=async s=>{if(s.preventDefault(),!N)return;if(k(!0),!N.room_type_name||!N.base_price||!N.max_guests||isNaN(parseFloat(N.base_price))||0>=parseFloat(N.base_price)||isNaN(parseInt(N.max_guests,10))||0>=parseInt(N.max_guests,10)){(0,o.Am)({variant:"destructive",title:"Validation Error",description:"Please fill Room Type Name, Base Price, and Max Guests with valid numbers."}),k(!1);return}let a={room_type_name:N.room_type_name,base_price:parseFloat(N.base_price),max_guests:parseInt(N.max_guests,10),quantity_available:N.quantity_available?parseInt(N.quantity_available,10):null,amenities:JSON.stringify(N.amenities),images:JSON.stringify(N.images)};try{let s=await fetch("/api/vendor/hotels/".concat(t,"/rooms/").concat(m),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),r=await s.json();if(!s.ok||!r.success)throw Error(r.message||"Failed to update room type");(0,o.Am)({title:"Success",description:"Room type updated successfully."}),e.push("/hotels/".concat(t,"/rooms"))}catch(e){console.error("Error updating room type:",e),(0,o.Am)({variant:"destructive",title:"Error",description:e instanceof Error?e.message:"Could not update room type."})}finally{k(!1)}};return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto",children:[(0,a.jsx)("nav",{className:"mb-6 text-sm text-gray-500","aria-label":"Breadcrumb",children:(0,a.jsxs)("ol",{className:"list-none p-0 inline-flex space-x-2",children:[(0,a.jsx)("li",{className:"flex items-center",children:(0,a.jsx)(u.default,{href:"/dashboard",className:"hover:text-indigo-600 hover:underline",children:"Dashboard"})}),(0,a.jsx)("li",{children:(0,a.jsx)("span",{className:"text-gray-400",children:"/"})}),(0,a.jsx)("li",{className:"flex items-center",children:(0,a.jsx)(u.default,{href:"/hotels",className:"hover:text-indigo-600 hover:underline",children:"Hotels"})}),(0,a.jsx)("li",{children:(0,a.jsx)("span",{className:"text-gray-400",children:"/"})}),(0,a.jsx)("li",{className:"flex items-center",children:(0,a.jsx)(u.default,{href:"/hotels/".concat(t,"/edit"),className:"hover:text-indigo-600 hover:underline truncate max-w-[150px]",children:L})}),(0,a.jsx)("li",{children:(0,a.jsx)("span",{className:"text-gray-400",children:"/"})}),(0,a.jsx)("li",{className:"flex items-center",children:(0,a.jsx)(u.default,{href:"/hotels/".concat(t,"/rooms"),className:"hover:text-indigo-600 hover:underline",children:"Rooms"})}),(0,a.jsx)("li",{children:(0,a.jsx)("span",{className:"text-gray-400",children:"/"})}),(0,a.jsxs)("li",{className:"flex items-center text-gray-700 font-medium truncate max-w-[150px]",children:["Edit: ",N.room_type_name]})]})}),(0,a.jsxs)("h2",{className:"text-2xl font-semibold text-gray-800 mb-6 flex items-center",children:[(0,a.jsx)(c.Z,{size:24,className:"mr-3 text-indigo-600"})," Edit Room Type: ",N.room_type_name]}),(0,a.jsxs)("form",{onSubmit:G,className:"space-y-6",children:[(0,a.jsxs)("fieldset",{className:"border border-gray-200 p-6 rounded-lg shadow-sm",children:[(0,a.jsx)("legend",{className:"text-lg font-semibold text-gray-700 px-2",children:"Room Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsxs)("label",{htmlFor:"room_type_name",className:"block text-sm font-medium text-gray-700 mb-1",children:["Room Type Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",id:"room_type_name",name:"room_type_name",value:N.room_type_name,onChange:V,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"e.g., Deluxe Double, Standard Single"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"base_price",className:"block text-sm font-medium text-gray-700 mb-1",children:["Base Price/Night (INR) ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"number",id:"base_price",name:"base_price",value:N.base_price,onChange:V,required:!0,min:"0",step:"0.01",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"e.g., 2500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"max_guests",className:"block text-sm font-medium text-gray-700 mb-1",children:["Max Guests ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"number",id:"max_guests",name:"max_guests",value:N.max_guests,onChange:V,required:!0,min:"1",step:"1",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"e.g., 2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"quantity_available",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity Available"}),(0,a.jsx)("input",{type:"number",id:"quantity_available",name:"quantity_available",value:N.quantity_available,onChange:V,min:"0",step:"1",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"e.g., 10"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Number of rooms of this type."})]})]})]}),(0,a.jsxs)("fieldset",{className:"border border-gray-200 p-6 rounded-lg shadow-sm",children:[(0,a.jsx)("legend",{className:"text-lg font-semibold text-gray-700 px-2",children:"Amenities & Images"}),(0,a.jsxs)("div",{className:"space-y-6 mt-4",children:[(0,a.jsx)(x.c,{label:"Room Amenities",name:"amenities",options:p,selectedValues:N.amenities,onChange:z,gridCols:3,helperText:"Select amenities available in this room type."}),(0,a.jsx)(y,{label:"Image URLs",name:"images",value:N.images,onChange:z,placeholder:"Enter image URL and press Enter",helperText:"Add URLs for photos specific to this room type."})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,a.jsx)(u.default,{href:"/hotels/".concat(t,"/rooms"),className:"bg-gray-200 text-gray-800 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-300 transition duration-150 ease-in-out",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:!!(w||U),className:"inline-flex items-center bg-indigo-600 text-white px-6 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150 ease-in-out",children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{size:16,className:"animate-spin mr-2"})," Saving Changes..."]}):"Save Changes"})]})]})]})}function j(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(f,{text:"Loading Edit Room Page..."}),children:(0,a.jsx)(v,{})})}}},function(e){e.O(0,[1451,8666,2971,2117,1744],function(){return e(e.s=8948)}),_N_E=e.O()}]);